app-id: engineer.atlas.Nyxt
# Not a mistake! We need the sonames of shared libraries for SBCL during runtime.
runtime: org.gnome.Sdk
runtime-version: "41"
sdk: org.gnome.Sdk
command: nyxt

finish-args:
  - --device=dri
  - --share=network
  - --socket=wayland
  - --socket=fallback-x11
  - --socket=pulseaudio
  - --socket=cups
  - --filesystem=xdg-documents
  - --filesystem=xdg-download
  - --filesystem=xdg-music
  - --filesystem=xdg-videos
  - --filesystem=xdg-pictures
  - --talk-name=org.a11y.Bus

modules:
  - name: sbcl
  - name: libfixposix
    buildsystem: autotools
    sources:
      - type: git
        url: https://github.com/sionescu/libfixposix.git
        tag: v0.4.3
      - type: script
        dest-filename: autogen.sh
        commands:
          - autoreconf -fi

  - name: nyxt
    buildsystem: simple
    sources:
      - type: file
        url: https://github.com/atlas-engineer/nyxt/releases/download/3-pre-release-3/nyxt-3-pre-release-3-source-with-submodules.tar.xz
        sha256: f5f13c78ed89aa41813c702b8ee04597e976b8d1c3a78ac7c8f6b706e11b8cda
        dest-filename: nyxt.tar.xz
        only-arches: [x86_64]
      - type: file
        path: engineer.atlas.Nyxt.appdata.xml
    build-commands:
      - tar xvf nyxt.tar.xz
      - make all
      - desktop-file-edit $FLATPAK_DEST/share/applications/nyxt.desktop --set-icon=engineer.atlas.Nyxt
      - find $FLATPAK_DEST/share -type f -exec rename nyxt engineer.atlas.Nyxt '{}' \;
      - cp /usr/lib/$(gcc --print-multiarch)/libbfd-*.so /app/lib
      - install -D engineer.atlas.Nyxt.appdata.xml /app/share/appdata/engineer.atlas.Nyxt.appdata.xml
    build-options:
      no-debuginfo: false
